<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>moanin package • moanin</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="moanin package">
<meta property="og:description" content="moanin">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">moanin</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.99.0-901</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/documentation.html">moanin package</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>moanin package</h1>
            
      
      
      <div class="hidden name"><code>documentation.Rmd</code></div>

    </div>

    
    
<p>The package moanin was developed to provide a simple and efficient workflow for long time-course gene expression data. It makes it simple to do differential expression between conditions based on either individual condition comparisons per time point, or by fitting spline functions per gene. There are also functions to help with clustering and visualization.</p>
<p>We do not detail all of the features of the package here, but some of the main functions. See our more indepth workflow paper at <a href="https://github.com/NelleV/2019timecourse-rnaseq-pipeline" class="uri">https://github.com/NelleV/2019timecourse-rnaseq-pipeline</a>.</p>
<div id="setup" class="section level1">
<h1 class="hasAnchor">
<a href="#setup" class="anchor"></a>Setup</h1>
<p>We will work with time course data available in the accompanying <code>timecoursedata</code> package. This is mRNA-Seq timecourse data on a plant, sorghum. The plants were sampled every week for 17 weeks. The plants were of two different varieties (i.e. different genotypes), and under three different watering conditions:</p>
<ul>
<li>Control: regular weekly watering</li>
<li>Preflowering drought: plants under drought under pre-flowering (weeks before week 9), and watered like control for week 9 and afterward.</li>
<li>Postflowering drought: plants were regularly watered pre-flowering (weeks through week 9), and then watering withheld weeks 10 onward.</li>
</ul>
<p>This data is available on both the leaf and the root sampled from the same plant. We will concentrate on the leaf samples, available as a dataset <code>varoquaux2019leaf</code>.</p>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">moanin</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">timecoursedata</span>)
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(<span class="no">varoquaux2019leaf</span>)
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span>(<span class="no">varoquaux2019leaf</span>)</pre></body></html></div>
<pre><code>## [1] "data" "meta"</code></pre>
<p>The <code>data</code> element contains the gene expression data, while the <code>meta</code> data consists of information regarding the samples.</p>
<p>For simplicity, we are going to focus on comparing the three different watering conditions within the “BT642” variety (the variety known for comparative tolerance of pre-flowering drought). We are also going to drop Week 2, which is only measured in the control samples.</p>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="no">whSamples</span><span class="kw">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/with.html">with</a></span>(<span class="no">varoquaux2019leaf</span>$<span class="no">meta</span>,<span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span>(<span class="no">Genotype</span><span class="kw">==</span><span class="st">"BT642"</span> <span class="kw">&amp;</span> <span class="no">Week</span> <span class="kw">&gt;</span><span class="fl">2</span>))
<span class="no">preData</span><span class="kw">&lt;-</span><span class="no">varoquaux2019leaf</span>$<span class="no">data</span>[,<span class="no">whSamples</span>]
<span class="no">preMeta</span><span class="kw">&lt;-</span><span class="no">varoquaux2019leaf</span>$<span class="no">meta</span>[<span class="no">whSamples</span>,]
<span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span>(<span class="no">preData</span>)</pre></body></html></div>
<pre><code>## [1] 34211    97</code></pre>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span>(<span class="no">preMeta</span>)</pre></body></html></div>
<pre><code>## [1] 97 22</code></pre>
</div>
<div id="set-up-moanin-class" class="section level1">
<h1 class="hasAnchor">
<a href="#set-up-moanin-class" class="anchor"></a>Set up <code>moanin</code> class</h1>
<p>The first step is to create a moanin class, which uses our meta data to create the needed information for future analysis. Specifically, in addition to storing the meta information, the function <code>create_moanin_model</code> will define a splines basis for future calculations. By default the model is given as a separate spline basis for each level of a factor <code>Group</code>, plus a group intercept with the following R formula</p>
<p><code>~Group:ns(Timepoint, df=4) + Group + 0</code></p>
<div class="sourceCode" id="cb7"><html><body><pre class="r"><span class="no">moaninObject</span><span class="kw">&lt;-</span><span class="fu"><a href="../reference/Moanin-class.html">create_moanin_model</a></span>(<span class="kw">data</span><span class="kw">=</span><span class="no">preData</span>,<span class="kw">meta</span><span class="kw">=</span><span class="no">preMeta</span>,
                            <span class="kw">group_variable</span><span class="kw">=</span><span class="st">"Condition"</span>, <span class="kw">time_variable</span> <span class="kw">=</span> <span class="st">"Week"</span>)
<span class="no">moaninObject</span></pre></body></html></div>
<pre><code>## Moanin object on 97 samples containing the following information:
## Group variable given by 'Condition' with the following levels:
##       Control Postflowering  Preflowering 
##            37            21            39 
## Time variable given by 'Week'
## Basis matrix with 15 basis_matrix functions
## Basis matrix was constructed with the following spline_formula
## ~Condition + Condition:splines::ns(Week, df = 4) + 0 
## 
## Information about the data (a SummarizedExperiment object):
## class: SummarizedExperiment 
## dim: 34211 97 
## metadata(0):
## assays(1): ''
## rownames(34211): Sobic.001G000100.v3.1 Sobic.001G000200.v3.1 ...
##   Sobic.K044420.v3.1 Sobic.K044505.v3.1
## rowData names(0):
## colnames(97): 0622162L06 0622162L14 ... 0928169L11 0928169L19
## colData names(23): Barcode libraryName ... Group WeeklyGroup</code></pre>
</div>
<div id="weekly-differential-expression-analysis" class="section level1">
<h1 class="hasAnchor">
<a href="#weekly-differential-expression-analysis" class="anchor"></a>Weekly differential expression analysis</h1>
<p>One type of DE analysis we can do is to compare our watering conditions to each other, for every time point. We do this via a call to <code>limma</code> for the DE analysis, but before we can do this, we need to set up the appropriate contrasts. For example, “Preflowering - Control” (see <code>?makeContrasts</code> in the limma package). We provide a function to do this for every week, so as to avoid this step.</p>
<div class="sourceCode" id="cb9"><html><body><pre class="r"><span class="no">preContrasts</span> <span class="kw">=</span> <span class="fu"><a href="../reference/DE_timepoints.html">create_timepoints_contrasts</a></span>(<span class="no">moaninObject</span>,<span class="st">"Preflowering"</span>, <span class="st">"Control"</span>)</pre></body></html></div>
<p>Notice we also get a warning that timepoint 16 is missing in our Control Samples (in fact, some of these time points only have a single observations per time point, which is not particularly appropriate for DE analysis per week).</p>
<p>We can also create contrasts to compare Postflowering and Control, and Preflowering and Postflowering. We get many warnings here, because Post-flowering only has samples after week 9.</p>
<div class="sourceCode" id="cb10"><html><body><pre class="r"><span class="no">postContrasts</span> <span class="kw">=</span> <span class="fu"><a href="../reference/DE_timepoints.html">create_timepoints_contrasts</a></span>(<span class="no">moaninObject</span>,<span class="st">"Postflowering"</span>, <span class="st">"Control"</span> )
<span class="no">prepostContrasts</span> <span class="kw">=</span> <span class="fu"><a href="../reference/DE_timepoints.html">create_timepoints_contrasts</a></span>(<span class="no">moaninObject</span>,<span class="st">"Postflowering"</span>, <span class="st">"Preflowering"</span>)</pre></body></html></div>
<p>We can run the DE analysis, setting <code>use_voom_weights=TRUE</code> to make use of <code>limma</code> correction for low-counts. We will subset to just the first 500 genes for illustration purposes, though the full set of genes does not take very long</p>
<div class="sourceCode" id="cb11"><html><body><pre class="r"><span class="no">weeklyPre</span><span class="kw">&lt;-</span><span class="fu"><a href="../reference/DE_timepoints.html">DE_timepoints</a></span>(<span class="no">moaninObject</span>[<span class="fl">1</span>:<span class="fl">500</span>,],
    <span class="kw">contrasts</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="no">preContrasts</span>,<span class="no">postContrasts</span>,<span class="no">prepostContrasts</span>),
     <span class="kw">use_voom_weights</span><span class="kw">=</span><span class="fl">TRUE</span>)</pre></body></html></div>
<p>The results give the raw p-value (<code>_pval</code>), the FDR adjusted p-values (<code>_qval</code>), and the estimate of log-fold-change (<code>_lfc</code>) for each week (3 columns for each of the 31 contrasts):</p>
<div class="sourceCode" id="cb12"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span>(<span class="no">weeklyPre</span>)</pre></body></html></div>
<pre><code>## [1] 500  93</code></pre>
<div class="sourceCode" id="cb14"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">weeklyPre</span>[,<span class="fl">1</span>:<span class="fl">10</span>])</pre></body></html></div>
<pre><code>##                       Preflowering.3-Control.3_pval
## Sobic.001G000100.v3.1                    0.76935240
## Sobic.001G000200.v3.1                    0.01705126
## Sobic.001G000300.v3.1                    0.75896765
## Sobic.001G000400.v3.1                    0.23770107
## Sobic.001G000501.v3.1                    0.75896765
## Sobic.001G000700.v3.1                    0.05734872
##                       Preflowering.3-Control.3_qval
## Sobic.001G000100.v3.1                     0.9806377
## Sobic.001G000200.v3.1                     0.1792723
## Sobic.001G000300.v3.1                     0.9795879
## Sobic.001G000400.v3.1                     0.6740071
## Sobic.001G000501.v3.1                     0.9795879
## Sobic.001G000700.v3.1                     0.3530203
##                       Preflowering.3-Control.3_lfc
## Sobic.001G000100.v3.1                    2.4312650
## Sobic.001G000200.v3.1                    1.5852637
## Sobic.001G000300.v3.1                   -1.9235186
## Sobic.001G000400.v3.1                    0.9811749
## Sobic.001G000501.v3.1                   -1.0133240
## Sobic.001G000700.v3.1                   -0.6885880
##                       Preflowering.4-Control.4_pval
## Sobic.001G000100.v3.1                     0.2290217
## Sobic.001G000200.v3.1                     0.9860256
## Sobic.001G000300.v3.1                     0.2083560
## Sobic.001G000400.v3.1                     0.9176221
## Sobic.001G000501.v3.1                     0.2083560
## Sobic.001G000700.v3.1                     0.1970270
##                       Preflowering.4-Control.4_qval
## Sobic.001G000100.v3.1                     0.6639340
## Sobic.001G000200.v3.1                     0.9996942
## Sobic.001G000300.v3.1                     0.6398885
## Sobic.001G000400.v3.1                     0.9921867
## Sobic.001G000501.v3.1                     0.6398885
## Sobic.001G000700.v3.1                     0.6282489
##                       Preflowering.4-Control.4_lfc
## Sobic.001G000100.v3.1                    1.0249975
## Sobic.001G000200.v3.1                    1.1352912
## Sobic.001G000300.v3.1                    0.6779068
## Sobic.001G000400.v3.1                   -0.4052482
## Sobic.001G000501.v3.1                    3.0543973
## Sobic.001G000700.v3.1                   -2.5260550
##                       Preflowering.5-Control.5_pval
## Sobic.001G000100.v3.1                    0.64964783
## Sobic.001G000200.v3.1                    0.03384720
## Sobic.001G000300.v3.1                    0.63455782
## Sobic.001G000400.v3.1                    0.62792598
## Sobic.001G000501.v3.1                    0.63455782
## Sobic.001G000700.v3.1                    0.08759985
##                       Preflowering.5-Control.5_qval
## Sobic.001G000100.v3.1                     0.9465706
## Sobic.001G000200.v3.1                     0.2640320
## Sobic.001G000300.v3.1                     0.9417509
## Sobic.001G000400.v3.1                     0.9405412
## Sobic.001G000501.v3.1                     0.9417509
## Sobic.001G000700.v3.1                     0.4388142
##                       Preflowering.5-Control.5_lfc
## Sobic.001G000100.v3.1                    0.9699917
## Sobic.001G000200.v3.1                   -5.4320308
## Sobic.001G000300.v3.1                    1.7300535
## Sobic.001G000400.v3.1                    1.2150398
## Sobic.001G000501.v3.1                   -0.7634983
## Sobic.001G000700.v3.1                   -0.7326084
##                       Preflowering.6-Control.6_pval
## Sobic.001G000100.v3.1                     0.9438199
## Sobic.001G000200.v3.1                     0.3823328
## Sobic.001G000300.v3.1                     0.9412143
## Sobic.001G000400.v3.1                     0.3198618
## Sobic.001G000501.v3.1                     0.9412143
## Sobic.001G000700.v3.1                     0.6082270</code></pre>
</div>
<div id="time-course-differential-expression-analysis-between-two-groups" class="section level1">
<h1 class="hasAnchor">
<a href="#time-course-differential-expression-analysis-between-two-groups" class="anchor"></a>Time-course differential expression analysis between two groups</h1>
<p>The results of such a weekly analysis can be quite difficult to interpret, the number of replicates per week can be quite low, and different numbers of replicates in different weeks can make it difficult to compare the analysis across weeks.</p>
<p>An alternative approach is to fit a smooth spline to each gene per group, and perform differential tests as to whether there are differences between the spline functions between two groups. We provide this function in <code>DE_timecourse</code>, where the user provides a string of comparisons that they wish to make:</p>
<div class="sourceCode" id="cb16"><html><body><pre class="r"><span class="no">timecourseContrasts</span><span class="kw">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Preflowering-Control"</span>,<span class="st">"Postflowering-Control"</span>,<span class="st">"Postflowering-Preflowering"</span>)
<span class="no">splinePre</span><span class="kw">&lt;-</span><span class="fu"><a href="../reference/DE_timecourse.html">DE_timecourse</a></span>(<span class="no">moaninObject</span>[<span class="fl">1</span>:<span class="fl">500</span>,], <span class="kw">contrasts</span><span class="kw">=</span><span class="no">timecourseContrasts</span>,
     <span class="kw">use_voom_weights</span><span class="kw">=</span><span class="fl">FALSE</span>)</pre></body></html></div>
<p>Each contrast has a <code>pval</code> and a <code>qval</code> column:</p>
<div class="sourceCode" id="cb17"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">splinePre</span>)</pre></body></html></div>
<pre><code>##                       Preflowering-Control_pval Preflowering-Control_qval
## Sobic.001G000100.v3.1                 0.8720704                 0.8928694
## Sobic.001G000200.v3.1                 0.3330619                 0.4633905
## Sobic.001G000300.v3.1                       NaN                       NaN
## Sobic.001G000400.v3.1                 0.1640645                 0.2873066
## Sobic.001G000501.v3.1                       NaN                       NaN
## Sobic.001G000700.v3.1                 0.7138069                 0.7716831
##                       Postflowering-Control_pval Postflowering-Control_qval
## Sobic.001G000100.v3.1                          0                          0
## Sobic.001G000200.v3.1                          0                          0
## Sobic.001G000300.v3.1                        NaN                        NaN
## Sobic.001G000400.v3.1                          0                          0
## Sobic.001G000501.v3.1                        NaN                        NaN
## Sobic.001G000700.v3.1                          0                          0
##                       Postflowering-Preflowering_pval
## Sobic.001G000100.v3.1                               0
## Sobic.001G000200.v3.1                               0
## Sobic.001G000300.v3.1                             NaN
## Sobic.001G000400.v3.1                               0
## Sobic.001G000501.v3.1                             NaN
## Sobic.001G000700.v3.1                               0
##                       Postflowering-Preflowering_qval
## Sobic.001G000100.v3.1                               0
## Sobic.001G000200.v3.1                               0
## Sobic.001G000300.v3.1                             NaN
## Sobic.001G000400.v3.1                               0
## Sobic.001G000501.v3.1                             NaN
## Sobic.001G000700.v3.1                               0</code></pre>
<p>There is not a log-fold change column, because it is more complicated to define the log-fold change over a series of timepoints, where potentially the means may even switch from being over-expressed to under-expressed. We provide a function <code>estimate_log_fold_change</code> which gives the option of estimating several kinds of log-fold-change. We demonstrate with the method <code>abs_sum</code>, which gives the sum of the absolute difference in the means across time points:</p>
<div class="sourceCode" id="cb19"><html><body><pre class="r"><span class="no">log_fold_change_timepoints</span> <span class="kw">=</span> <span class="fu"><a href="../reference/estimate_log_fold_change.html">estimate_log_fold_change</a></span>(<span class="no">moaninObject</span>[<span class="fl">1</span>:<span class="fl">500</span>,], <span class="kw">contrasts</span><span class="kw">=</span><span class="no">timecourseContrasts</span>,  <span class="kw">method</span><span class="kw">=</span><span class="st">"sum"</span>)
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">log_fold_change_timepoints</span>)</pre></body></html></div>
<pre><code>##                       Preflowering-Control Postflowering-Control
## Sobic.001G000100.v3.1           -0.3333333            -0.3333333
## Sobic.001G000200.v3.1          212.6666667             7.0000000
## Sobic.001G000300.v3.1            0.0000000             0.0000000
## Sobic.001G000400.v3.1          103.0000000            78.3333333
## Sobic.001G000501.v3.1            0.0000000             0.0000000
## Sobic.001G000700.v3.1          -68.3333333           875.0000000
##                       Postflowering-Preflowering
## Sobic.001G000100.v3.1                    0.00000
## Sobic.001G000200.v3.1                 -205.66667
## Sobic.001G000300.v3.1                    0.00000
## Sobic.001G000400.v3.1                  -24.66667
## Sobic.001G000501.v3.1                    0.00000
## Sobic.001G000700.v3.1                  943.33333</code></pre>
<p>See <code><a href="../reference/estimate_log_fold_change.html">?estimate_log_fold_change</a></code> to see the full set of methods.</p>
</div>
<div id="visualizing-genes-of-interest" class="section level1">
<h1 class="hasAnchor">
<a href="#visualizing-genes-of-interest" class="anchor"></a>Visualizing Genes of Interest</h1>
<p>The package <code>moanin</code> also provides a simple utility function (<code>plot_splines_data</code>) to visualize gene time-course data from different conditions. We use this to plot the 10 genes with the largest log-fold-change in <code>Preflowering-Control</code> contrast (since we only looked at the first top 500, these aren’t representative of the overall signal in the data set, which is much stronger).</p>
<div class="sourceCode" id="cb21"><html><body><pre class="r"><span class="no">whSig</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span>(<span class="no">splinePre</span>[,<span class="st">"Preflowering-Control_qval"</span>]<span class="kw">&lt;</span><span class="fl">0.05</span>)
<span class="no">deGenes</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/order.html">order</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span>(<span class="no">log_fold_change_timepoints</span>)[<span class="no">whSig</span>,<span class="st">"Preflowering-Control"</span>],<span class="kw">decreasing</span><span class="kw">=</span><span class="fl">TRUE</span>)[<span class="fl">1</span>:<span class="fl">10</span>]

<span class="fu"><a href="../reference/plot_splines_data.html">plot_splines_data</a></span>(<span class="no">moaninObject</span>[<span class="no">whSig</span>, ][<span class="no">deGenes</span>,],
    <span class="kw">smooth</span><span class="kw">=</span><span class="fl">TRUE</span>, <span class="kw">mar</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1.5</span>,<span class="fl">2.5</span>,<span class="fl">2</span>,<span class="fl">0.1</span>))</pre></body></html></div>
<p><img src="documentation_files/figure-html/unnamed-chunk-12-1.png" width=".5\textwidth"></p>
</div>
<div id="clustering-of-time-course-data" class="section level1">
<h1 class="hasAnchor">
<a href="#clustering-of-time-course-data" class="anchor"></a>Clustering of time-course data</h1>
<p>We can also cluster the data based on their spline fits. Here we would like to work with the log transform of the counts which are stored in <code>moaninObject</code>, so we set <code>log_transform=TRUE</code>.</p>
<div class="sourceCode" id="cb22"><html><body><pre class="r"><span class="co"># First fit the kmeans clusters</span>
<span class="no">kmeans_clusters</span> <span class="kw">=</span> <span class="fu"><a href="../reference/splines_kmeans.html">splines_kmeans</a></span>(<span class="no">moaninObject</span>[<span class="fl">1</span>:<span class="fl">500</span>,], <span class="kw">n_clusters</span><span class="kw">=</span><span class="fl">3</span>,
    <span class="kw">random_seed</span><span class="kw">=</span><span class="fl">42</span>,
    <span class="kw">n_init</span><span class="kw">=</span><span class="fl">20</span>)</pre></body></html></div>
<p>We then use the <code>plot_splines_data</code> function, only now applied to the centroids of the kmeans clustering, to visualize the centroids of each cluster obtained with the splines k-means model.</p>
<div class="sourceCode" id="cb23"><html><body><pre class="r"><span class="fu"><a href="../reference/plot_splines_data.html">plot_splines_data</a></span>(
    <span class="kw">data</span><span class="kw">=</span><span class="no">kmeans_clusters</span>$<span class="no">centroids</span>, <span class="no">moaninObject</span>,
    <span class="kw">smooth</span><span class="kw">=</span><span class="fl">TRUE</span>)</pre></body></html></div>
<p><img src="documentation_files/figure-html/unnamed-chunk-13-1.png" width=".5\textwidth"></p>
<div id="assigning-genes-to-clusters" class="section level2">
<h2 class="hasAnchor">
<a href="#assigning-genes-to-clusters" class="anchor"></a>Assigning genes to clusters</h2>
<p>Because there is variability in how well the genes fit a cluster, we would like to be able to score how well a gene fits a cluster. Furthermore, we often chose a subset of genes based on a filtering process, and we would like to have a mechanism to assign all genes to a cluster.</p>
<p>The function <code>splines_kmeans_score_and_label</code> gives a goodness-of-fit score between each gene and each cluster.</p>
<div class="sourceCode" id="cb24"><html><body><pre class="r"><span class="no">scores_and_labels</span> <span class="kw">=</span> <span class="fu"><a href="../reference/splines_kmeans_score_and_label.html">splines_kmeans_score_and_label</a></span>(<span class="kw">object</span><span class="kw">=</span><span class="no">moaninObject</span>,<span class="kw">data</span><span class="kw">=</span><span class="no">preData</span>[<span class="fl">1</span>:<span class="fl">2000</span>,], <span class="kw">kmeans_clusters</span><span class="kw">=</span><span class="no">kmeans_clusters</span>)</pre></body></html></div>
<p>Notice that we used more genes here (first 2000), even though previously we only used first 500 to make the clusters. These choices were unrealistic, since in practice we would probably pick high variable genes or differentially expressed genes, rather than the first 500, but at least give a sense of how this works.</p>
<p>The result is a list with elements <code>scores</code> and <code>labels</code>. <code>scores</code> gives the goodness-of-fit score between each gene and each cluster</p>
<div class="sourceCode" id="cb25"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">scores_and_labels</span>$<span class="no">scores</span>)</pre></body></html></div>
<pre><code>##                            [,1]      [,2]      [,3]
## Sobic.001G000100.v3.1 0.9979535 0.9867139 0.9999825
## Sobic.001G000200.v3.1 0.9999940 0.9030656 0.9999523
## Sobic.001G000300.v3.1 1.0000000 1.0000000 1.0000000
## Sobic.001G000400.v3.1 1.0000000 0.8524792 1.0000000
## Sobic.001G000501.v3.1 1.0000000 1.0000000 1.0000000
## Sobic.001G000700.v3.1 0.9689555 0.9146831 0.9965017</code></pre>
<p><code>labels</code> gives the best cluster assignment for each gene, but only if its score in its best cluster is above a certain threshold (see <code><a href="../reference/splines_kmeans_score_and_label.html">?splines_kmeans_score_and_label</a></code>)</p>
<div class="sourceCode" id="cb27"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">scores_and_labels</span>$<span class="no">labels</span>)</pre></body></html></div>
<pre><code>## Sobic.001G000100.v3.1 Sobic.001G000200.v3.1 Sobic.001G000300.v3.1 
##                    NA                     2                    NA 
## Sobic.001G000400.v3.1 Sobic.001G000501.v3.1 Sobic.001G000700.v3.1 
##                     2                    NA                     2</code></pre>
<div class="sourceCode" id="cb29"><html><body><pre class="r"><span class="co"># How many are not assigned a label?</span>
<span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span>(<span class="no">scores_and_labels</span>$<span class="no">labels</span>))</pre></body></html></div>
<pre><code>## [1] 1000</code></pre>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by <a href="https://nellev.github.io/">Nelle Varoquaux</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
